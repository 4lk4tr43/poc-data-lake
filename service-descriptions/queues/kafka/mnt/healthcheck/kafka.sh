set -ue

KAFKA_PORT=${KAFKA_PORT:-9092}

expected="0000010c0000000100000000002b00000000000700010000000a00020000
000400030000000700040000000100050000000000060000000400070000
0001000800000006000900000005000a00000002000b00000003000c0000
0002000d00000002000e00000002000f0000000200100000000200110000
000100120000000200130000000300140000000300150000000100160000
0001001700000002001800000001001900000001001a00000001001b0000
0000001c00000002001d00000001001e00000001001f0000000100200000
000200210000000100220000000100230000000100240000000000250000
0001002600000001002700000001002800000001002900000001002a0000
0001"

res=$(echo '0000000e001200000000000100046d656565' | xxd -r -p | nc -c localhost $KAFKA_PORT | xxd -l 218 -p)
rc=$?
if [ "$res" != "$expected" ]; then
  echo "Bad result: $res"
  echo "rc was: $rc"
  exit 1
fi
